<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="blip blop">
    <title>PowerSocket Webapplication</title>

    <!-- Pure CSS -->
    <link href="css/pure-min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/side-menu.css" rel="stylesheet">

</head>

<body>
    <div id="layout">
        <!-- Menu toggle -->
        <a href="#menu" id="menuLink" class="menu-link">
            <span></span>
        </a>

        <div id="menu">
            <div class="pure-menu">
                <a class="pure-menu-heading" href="#">Stuff..</a>

                <ul class="pure-menu-list">
                        <li class="pure-menu-item">
                            <a class="pure-menu-link" href="index.shtml">Dashboard</a>
                        </li>
                        <li class="pure-menu-item">
                            <a class="pure-menu-link" href="ota.shtml">OTA Upgrade</a>
                        </li>
                        <li class="pure-menu-item">
                            <a class="pure-menu-link" href="reboot.shtml">Restart</a>
                        </li>
                        <li class="pure-menu-item">
                            <a class="pure-menu-link" href="settings.shtml">Settings</a>
                        </li>
                        <li class="pure-menu-item">
                            <a class="pure-menu-link" href="status.shtml">Status</a>
                        </li>
                        <li class="pure-menu-item">
                            <a class="pure-menu-link" href="sockets.shtml">Sockets</a>
                        </li>
                        <li class="pure-menu-item">
                            <a class="pure-menu-link" href="calibrations.shtml">Calibrations</a>
                        </li>

                    </ul>
                </div>
            </div>
<link href="css/switch.css" rel="stylesheet">

<div id="main">
<div class="header">
<h1>Sockets</h1>
<h2>Here you can turn the sockets on and off</h2>
</div>
<div class="content">
<h2 class="content-subhead">Switch the sockets</h2>
<div id="switch_forms">
</div>
</div>
</div>
</div>

<script src="js/ui.js"></script>
<script src="js/jquery.min.js"></script>

<!-- When the document has finished loading, create the html for the switches.-->

<!-- We continously poll to get updates. This could probably be improved so we don't rewrite the entire form each time....-->


<script language="javascript" type="text/javascript">
$( document ).ready(function update_checkbox() {
	$.ajax({
		url: '/api/v1/get_switch_state',
		method: 'GET',
		dataType: 'json',
		cache:false,
		data: {},
		success: function(json) {
			var form_str = "";
			for(i = 0; i < parseInt(json.count); i++ ){
				var switch_name = "switch" + i;
				form_str += "<div class='pure-control-group checkbox-switch'>";
				form_str += "<input type='checkbox' class='input-checkbox' value='1'  id='switch" + i + "' name='switch" + i + "'";
				if(parseInt(json[switch_name].state) == 1){
					form_str += "checked";
				}
				form_str += " />";
				form_str += "<div class='checkbox-animate'><span class='checkbox-off'>OFF</span><span class='checkbox-on'>ON</span></div></div></br>"
			}
			$('#switch_forms').html(form_str);
		},
		complete: function() {
		// Schedule the next request when the current one's complete
		setTimeout(update_checkbox, 1000);
		}
	});

	$("#switch_forms").on("change", "input", function () {
            // AJAX Code To Submit Form.
            $.ajax({
                type: "POST",
                url: "set_state.php",
                data: $(this).serialize(),
                cache: false,
                success: function(result){
                    alert(result);
                }
          });
 	});

});
</script>


</body>

</html>
